C51 COMPILER V9.53.0.0   MAIN                                                              11/21/2019 16:10:39 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\obj\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\main\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\main) DEBUG OBJECTEXTEN
                    -D PRINT(..\obj\main.lst) TABS(2) OBJECT(..\obj\main.obj)

line level    source

   1          #include "main.h"
   2          #include "intrins.h"
   3          #include <stdio.h>
   4          #include <stdlib.h>
   5          #include <math.h>
   6          
   7           
   8          #define WS2812  P55
   9           
  10          //1码，高电平850ns 低电平400ns 误差正负150ns
  11          void RGB_Set_Up()
  12          {
  13   1        EA = 0;
  14   1        WS2812 = 1;
  15   1        _nop_(); _nop_();
  16   1        WS2812 = 0;
  17   1        EA = 1;
  18   1      }
  19           
  20          //1码，高电平400ns 低电平850ns 误差正负150ns
  21          void RGB_Set_Down()
  22          {
  23   1        EA = 0;
  24   1        WS2812 = 1;
  25   1        _nop_(); _nop_(); _nop_(); _nop_(); _nop_(); _nop_();
  26   1        _nop_(); _nop_(); _nop_(); _nop_(); _nop_(); _nop_();
  27   1        WS2812 = 0; 
  28   1        EA = 1;
  29   1      }
  30           
  31          //发送24位数据
  32          void Send_2811_24bits(unsigned char *p, unsigned int n )
  33          {
  34   1        unsigned int i;
  35   1        unsigned char value,j;
  36   1        for(i = 0; i < n; i ++)
  37   1        {
  38   2          value = p[i];
  39   2          for(j = 0; j < 8; j ++)
  40   2          {
  41   3            if((value & 0x80) == 0x80)
  42   3            {
  43   4              RGB_Set_Up();
  44   4            }
  45   3            else
  46   3            {
  47   4              RGB_Set_Down();
  48   4            }
  49   3            value <<= 1;
  50   3          }
  51   2        }
  52   1      }
  53          
  54          //复位码
C51 COMPILER V9.53.0.0   MAIN                                                              11/21/2019 16:10:39 PAGE 2   

  55          void RGB_Rst()
  56          {
  57   1        WS2812 = 0;
  58   1      }
  59          
  60          void delay50us(int t)   //@27.000MHz
  61          {
  62   1        int i, j;
  63   1        for(i = 0; i < t; i ++)
  64   1        {
  65   2          for(j = 0; j < 144; j ++);
  66   2        }
  67   1      }
  68          
  69          
  70          void setRGB(unsigned char *p,int Number, unsigned char G, unsigned char R, unsigned char B)
  71          {
  72   1        int value = 0;
  73   1        value = 3*Number; 
  74   1        p[ value + 0 ] = G;
  75   1        p[ value + 1 ] = R;
  76   1        p[ value + 2 ] = B;
  77   1      }
  78          
  79          void waterfall_light(unsigned char *p, int Number)
  80          {
  81   1        int i;
  82   1        for(i = 0; i < Number; i ++)
  83   1        {
  84   2          Send_2811_24bits(p,3*Number);
  85   2        }
  86   1        RGB_Rst();
  87   1      }
  88          
  89          
  90          void main()
  91          {
  92   1        unsigned char xdata M[3*16] = { 
  93   1          0  , 0  , 0  , 
  94   1          0  , 255, 255,
  95   1          255, 255, 0  ,
  96   1          0  , 255, 255,
  97   1        };
  98   1        unsigned char Number = 0;
  99   1      
 100   1        P5M0 = 0xFF;
 101   1        P5M1 = 0x00;  
 102   1        
 103   1        while(1)
 104   1        {
 105   2          Number ++ ;
 106   2          setRGB(M, Number % 16, 256 - Number, Number, Number );
 107   2          waterfall_light( M, 16 );
 108   2          delay50us(5);   //@27.000MHz
 109   2        }
 110   1      }
 111          
 112          
 113          
 114          
 115          
 116          
C51 COMPILER V9.53.0.0   MAIN                                                              11/21/2019 16:10:39 PAGE 3   

 117          
 118          
 119          
 120          
 121          
 122          
 123          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    328    ----
   CONSTANT SIZE    =     48    ----
   XDATA SIZE       =   ----      48
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      21
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
