C51 COMPILER V9.53.0.0   MAIN                                                              11/22/2019 00:24:22 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\obj\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\main\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\main) DEBUG OBJECTEXTEN
                    -D PRINT(..\obj\main.lst) TABS(2) OBJECT(..\obj\main.obj)

line level    source

   1          #include "main.h"
   2          #include "intrins.h"
   3          #include <stdio.h>
   4          #include <stdlib.h>
   5          #include <math.h>
   6          
   7          #define WS2812_1  P54
   8          #define WS2812_2  P55
   9           
  10          //发送24位数据
  11          void Send_2811_24bits(unsigned char *Line_1, unsigned char *Line_2, unsigned int n )
  12          {
  13   1        unsigned char value_1,value_2,j;
  14   1        value_1 = Line_1[n];
  15   1        value_2 = Line_2[n];
  16   1        for(j = 0; j < 8; j ++)
  17   1        {
  18   2          //0码，高电平850ns 低电平400ns 误差正负150ns
  19   2          if( ( ( value_1 & 0x80 ) == 0x80 ) && ( ( value_2 & 0x80 ) == 0x80 ) )
  20   2          {
  21   3            EA = 0;
  22   3            WS2812_1 = 1;
  23   3            WS2812_2 = 1;
  24   3            _nop_();
  25   3            _nop_();
  26   3            WS2812_1 = 0;
  27   3            WS2812_2 = 0;
  28   3            EA = 1;
  29   3          }else if( ( ( value_1 & 0x80 ) != 0x80 ) && ( ( value_2 & 0x80 ) == 0x80 )  )
  30   2          {
  31   3            EA = 0;
  32   3            WS2812_1 = 1;
  33   3            WS2812_2 = 1;
  34   3            _nop_(); 
  35   3            _nop_(); 
  36   3            WS2812_2 = 0;
  37   3            _nop_(); 
  38   3            _nop_(); 
  39   3            _nop_();
  40   3            _nop_(); 
  41   3            _nop_(); 
  42   3            _nop_(); 
  43   3            _nop_(); 
  44   3            _nop_(); 
  45   3            _nop_();
  46   3            _nop_();
  47   3            _nop_();
  48   3            WS2812_1 = 0; 
  49   3            EA = 1;
  50   3          }else if( ( ( value_1 & 0x80 ) == 0x80 ) && ( ( value_2 & 0x80 ) != 0x80 )  )
  51   2          {
  52   3            EA = 0;
  53   3            WS2812_1 = 1;
  54   3            WS2812_2 = 1;
C51 COMPILER V9.53.0.0   MAIN                                                              11/22/2019 00:24:22 PAGE 2   

  55   3            _nop_(); 
  56   3            _nop_(); 
  57   3            WS2812_1 = 0;
  58   3            _nop_(); 
  59   3            _nop_(); 
  60   3            _nop_();
  61   3            _nop_(); 
  62   3            _nop_(); 
  63   3            _nop_(); 
  64   3            _nop_(); 
  65   3            _nop_(); 
  66   3            _nop_();
  67   3            _nop_();
  68   3            _nop_();
  69   3            WS2812_2 = 0; 
  70   3            EA = 1;
  71   3          }else
  72   2          {
  73   3            EA = 0;
  74   3            WS2812_1 = 1;
  75   3            WS2812_2 = 1;
  76   3            _nop_(); 
  77   3            _nop_(); 
  78   3            _nop_(); 
  79   3            _nop_(); 
  80   3            _nop_();
  81   3            _nop_(); 
  82   3            _nop_(); 
  83   3            _nop_(); 
  84   3            _nop_(); 
  85   3            _nop_(); 
  86   3            _nop_();
  87   3            _nop_();
  88   3            _nop_();
  89   3            WS2812_1 = 0;
  90   3            WS2812_2 = 0; 
  91   3            EA = 1;
  92   3          }
  93   2          value_1 <<= 1;
  94   2          value_2 <<= 1;
  95   2        }
  96   1      }
  97          
  98          //复位码
  99          void RGB_Rst()
 100          {
 101   1        WS2812_1 = 0;
 102   1        WS2812_2 = 0;
 103   1      }
 104          
 105          void delay50us(int t)   //@27.000MHz
 106          {
 107   1        int i, j;
 108   1        for(i = 0; i < t; i ++)
 109   1        {
 110   2          for(j = 0; j < 144; j ++);
 111   2        }
 112   1      }
 113          
 114          
 115          void setRGB(unsigned char *p,int Number, unsigned char G, unsigned char R, unsigned char B)
 116          {
C51 COMPILER V9.53.0.0   MAIN                                                              11/22/2019 00:24:22 PAGE 3   

 117   1        int value = 0;
 118   1        value = 3*Number; 
 119   1        p[ value + 0 ] = G;
 120   1        p[ value + 1 ] = R;
 121   1        p[ value + 2 ] = B;
 122   1      }
 123          
 124          void waterfall_light(unsigned char *Line_1, unsigned char *Line_2, int Number)
 125          {
 126   1        int i;
 127   1        for(i = 0; i < Number; i ++)
 128   1        {
 129   2          Send_2811_24bits( Line_1, Line_2, i );
 130   2        }
 131   1        RGB_Rst();
 132   1      }
 133          
 134          
 135          void main()
 136          {
 137   1        unsigned char xdata Line_1[3*8];
 138   1        unsigned char xdata Line_2[3*8];
 139   1        unsigned char Number = 0;
 140   1        unsigned char bit_flag = 0;
 141   1      
 142   1        P5M0 = 0xFF;
 143   1        P5M1 = 0x00;  
 144   1        
 145   1        for(Number = 0; Number < 3*16; Number ++)
 146   1        {
 147   2          Line_1[ Number ] = 0xff;
 148   2          Line_2[ Number ] = 0xff;
 149   2        }
 150   1        
 151   1        setRGB( Line_1 , 0, 0, 0  , 0   );
 152   1        setRGB( Line_2 , 1, 0  , 0, 0   );
 153   1        
 154   1        while(1)
 155   1        {
 156   2          Number ++ ;
 157   2          
 158   2          if(bit_flag)
 159   2          {
 160   3            setRGB( Line_1 , 0, 0  , 0  , 0   );
 161   3            setRGB( Line_1 , 1, 255, 255, 255 );
 162   3          }
 163   2          else
 164   2          {
 165   3            setRGB( Line_1 , 0, 255, 255, 255 );
 166   3            setRGB( Line_1 , 1, 0  , 0  , 0   );
 167   3          }
 168   2          bit_flag = ~bit_flag;
 169   2          
 170   2      //    setRGB( Line_1 , Number % 8, Number, Number, Number );
 171   2      //    setRGB( Line_2 , Number % 8, 256 - Number, 256 -Number, Number );
 172   2          waterfall_light( Line_1, Line_2, 3 * 8 );
 173   2          delay50us(5);                 //@27.000MHz
 174   2        }
 175   1      }
 176          
 177          
 178          
C51 COMPILER V9.53.0.0   MAIN                                                              11/22/2019 00:24:22 PAGE 4   

 179          
 180          
 181          
 182          
 183          
 184          
 185          
 186          
 187          
 188          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    481    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      48
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      28
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
